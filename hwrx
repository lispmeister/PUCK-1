
frontend wwws
    mode http
    bind :8080 ssl crt /etc/d3ck/d3cks/D3CK/d3ck.all
    timeout client 1h

    acl is_sig path_beg /socket.io
    use_backend sock_signalz if is_sig

    acl is_websocket hdr(Upgrade) -i WebSocket
    use_backend sock_signalz if is_websocket

    # if all else fails... web
    default_backend www_backend

#
# web
#
backend www_backend
    mode http
    option forwardfor
    reqadd x-forwarded-proto:\ https
 
    server d3ck_www 10.22.51.1:5555 weight 1 maxconn 16384 check
 
#
# web sockets
#
backend websocket_backend
    mode http
    option forwardfor
#   option http-server-close
#   option forceclose
    no option httpclose

    server d3ck_sox 10.22.51.1:5555 weight 1 maxconn 999 check

#
# web RTC, may go local or to a remote d3ck
#
backend sock_signalz
    mode http
    option forwardfor
#   option http-server-close
#   option forceclose
    no option httpclose

    server d3ck_sox 10.218.143.1:5555 weight 1 maxconn 999 check
 
