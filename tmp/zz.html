<!DOCTYPE html>
<html lang="en">
  <head>

<meta charset="utf-8">
<title>PUCKasaurus Rex!</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="rawr!">

<!-- Le styles -->
<!-- <link href="/css/bootstrap.min.css" rel="stylesheet"> -->

<!-- made a one line change in this, noted at top -->
<link href="/css/bootstrap.css" rel="stylesheet"> 
<link href="/css/bootstrap-theme.min.css" rel="stylesheet"> 

<!-- for calls -->
<link href="/css/avgrund.css" rel="stylesheet">

<link href="/css/jquery.filer.css" rel="stylesheet">

<!-- trivial bits here -->
<link href="/css/puck.css" rel="stylesheet">

<style>

    .dragDropBox{
        position:relative;
        display:block;
        min-height: 200px; 
        width:500px; 
        background-color:#f3f3f3;
        border:2px dashed #aaa;
    }
    .dragDropBox span.message{
        color:#333;
        font-family:sans-serif;
        position:absolute;
        left:50%;
        margin-left:-105px;
        top:45%;
    }
    .dragDropBox:not(.done):hover, .dragDropBox.hover{
        opacity: 0.7;
        filter: alpha(opacity=70);
        cursor:pointer;
    }


</style>

<body>

        <div class="hero-unit">

        <div class="row clearfix spacer50">
            <div class="col-md-11 column">
            </div>
            <div id='far_right' class="col-md-1 column">
            </div>
        </div>

       <form action="/up" method="post" enctype="multipart/form-data">
         <p>Basic Options:</p>
         <input id="uppity" type="file" name="uppity" multiple="multiple" />
       </form> 

    </div>

</body>


<script type="text/javascript" src="/js/jquery-2.1.0.min.js"></script>

<script type="text/javascript" src='/js/jquery-ui.1.9.2.min.js'></script>
<script type="text/javascript" src='/js/bootstrap.js'></script>
<script type="text/javascript" src='/js/moustache.js'></script>
<script type="text/javascript" src='/js/jquery.adipoli.min.js'></script>
<script type="text/javascript" src='/js/jquery.json-2.4.min.js'></script>
<script type="text/javascript" src='/js/jquery.inputmask.js'></script>
<script type="text/javascript" src="/js/underscore-min.js"></script>

<script type="text/javascript" src='/js/spin.js'></script>
<script type="text/javascript" src='/js/jquery.blockUI.js'></script>
<script type="text/javascript" src='/js/jquery.avgrund.js'></script>
<script type="text/javascript" src="/js/jquery.bootstrap-growl.min.js"></script>
<script type="text/javascript" src="/js/bootstrap-paginator.js"></script>


<script type="text/javascript" src='/js/puck.js'></script>

<!-- file uploads -->
<script type="text/javascript" src="/js/jquery.filer.js"></script>

<script type="text/javascript">
var vpn_server = "local"

$(document).ready(function() {

        // status loop
        infinite();

        // poll until we get something, then stop polling
        var ping_poll      = 1000
        var already_polled = false
        var vpn_started    = false

        setInterval(drag_and_puck, ping_poll)

        // do this once... then wait for vpn to kick off

        // xxx - if were on the same page and you disconnect and reconect
        // again, this will probably be confused
        function drag_and_puck() {

            if (already_polled && vpn_started) return -1

            console.log('draggin n puckin')

            if  (typeof puck_status != "undefined" &&
                 typeof puck_status.openvpn_client != "undefined" && 
                 typeof puck_status.openvpn_client['server'] != "undefined" && 
                 puck_status.openvpn_client['server'] != "") {

                    vpn_server = puck_status.openvpn_client.server
                    console.log('vpn server: ' + vpn_server)
                    vpn_started = true
            }

            if (!already_polled || vpn_started) {

                console.log('drawin the box')

                // out with the old, in with the new
                $('.dragDropBox').remove()

            $('#uppity').filer({
                changeInput: '<div class="dragDropBox"><span class="message">Click or Drop files here to upload (' + vpn_server + ')</span></div>',
                appendTo   : '.dragDropBox',
                template   : '<img src="%image-url%" title="%original-name%" /><em>%title%</em>',
                maxSize    : 1024,
                uploadFile: {
                    // url:         'https://10.217.62.1:8080/up',
                    url:         '/up/' + vpn_server,
                    data:        {},
                    beforeSend:  function(parent){parent.append('<div class="progress-bar" />');},
                    success:     function(data, parent, progress){ },
                    error:       function(e, parent, progress){ },
                    progressEnd: function(progress){progress.addClass('done-erase');},
                    onUploaded:  function(parent){ }
                },
                dragDrop: {
                    dropBox:  '.dragDropBox',
                    dragOver: function(e, parent){ $('.dragDropBox').addClass('hover'); },
                    dragOut:  function(e, parent){ $('.dragDropBox').removeClass('hover'); },
                    drop:     function(e, formData, parent){ $('.dragDropBox').removeClass('hover'); },
                },
                onEmpty    : function(parent, appendBox){ $(appendBox).removeClass('done'); },
                onSelect   : function(e,parent,appendBox){ $(appendBox).addClass('done'); }
            })

            }

            already_polled = true

            return(ping_poll)
        }


});



</script>


</html>

